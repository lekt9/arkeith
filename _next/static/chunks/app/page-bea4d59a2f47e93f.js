(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{34143:(e,t,r)=>{Promise.resolve().then(r.bind(r,76774))},76774:(e,t,r)=>{"use strict";r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>c});var n=r(57437),a=r(48059),s=r.n(a),i=r(2265),l=r(92993),d=r(57818),p=r(42223);let e=(0,d.default)(()=>Promise.all([r.e(155),r.e(997)]).then(r.bind(r,68257)).then(e=>{let{Tldraw:t}=e;return e=>{let{children:r,...o}=e;return(0,n.jsx)(t,{...o,children:r})}}),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),{useEditor:g,Editor:u,Vec:f,createTLStore:h,Box:x,exportToBlob:m}=await Promise.all([r.e(155),r.e(997)]).then(r.bind(r,68257)),b=(e,t)=>Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),y=e=>{let{onShapesChange:t}=e,r=g(),o=(0,i.useRef)(new Map);return(0,i.useEffect)(()=>{if(!r)return()=>{};let e=()=>{let e=new Map,n=r.getCurrentPageShapes().filter(e=>{var t;return"text"in e.props&&r.isShapeOfType(e,"text")&&(null===(t=e.props.text)||void 0===t?void 0:t.trim())}),a=!1;n.forEach(t=>{let n=r.getShapePageBounds(t);if(n){let r={text:t.props.text||"",center:n.center};e.set(t.id,r);let s=o.current.get(t.id);s&&s.text===r.text&&s.center.x===r.center.x&&s.center.y===r.center.y||(a=!0)}}),o.current.size!==e.size&&(a=!0),a&&(o.current=e,t(e))};return r.addListener("change",e),()=>{r.removeListener("change",e)}},[r,t]),null},w=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;try{return await (0,l.ke)(e)}catch(r){if(t>0)return await new Promise(e=>setTimeout(e,1e3)),w(e,t-1);throw r}},S="tldraw-whiteboard-state",v=()=>(0,n.jsxs)("div",{style:{display:"inline-flex",marginLeft:"8px",verticalAlign:"middle"},className:"jsx-b31678e7f5f56372",children:[(0,n.jsx)(s(),{id:"b31678e7f5f56372",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}.spinner.jsx-b31678e7f5f56372{width:12px;height:12px;border:2px solid currentColor;border-right-color:transparent;-webkit-border-radius:50%;-moz-border-radius:50%;border-radius:50%;-webkit-animation:spin.75s linear infinite;-moz-animation:spin.75s linear infinite;-o-animation:spin.75s linear infinite;animation:spin.75s linear infinite}"}),(0,n.jsx)("div",{className:"jsx-b31678e7f5f56372 spinner"})]});function c(){let[t,r]=(0,i.useState)(""),[o,a]=(0,i.useState)([]),[s,d]=(0,i.useState)(null),c=(0,i.useRef)(null),[g]=(0,i.useState)(()=>h()),[u,C]=(0,i.useState)(!1),[j,I]=(0,i.useState)({status:"loading"}),[R,A]=(0,i.useState)(!1),[P,z]=(0,i.useState)([]),[B,M]=(0,i.useState)(""),O=new p.ZP({apiKey:"",dangerouslyAllowBrowser:!0}),[K,E]=(0,i.useState)(!1),[L,T]=(0,i.useState)(()=>{{let e=localStorage.getItem("whiteboard-settings");return e?JSON.parse(e):{groqApiKey:""}}}),[D,q]=(0,i.useState)(null);(0,i.useEffect)(()=>{try{let e=localStorage.getItem(S);if(e){let t=JSON.parse(e);g.loadSnapshot(t)}I({status:"ready"})}catch(e){I({status:"error",error:e.message})}},[g]),(0,i.useEffect)(()=>{if(!s)return;let e=s.store.listen(()=>{try{let e=s.store.getSnapshot();localStorage.setItem(S,JSON.stringify(e)),console.log("Saved whiteboard state to localStorage")}catch(e){console.error("Failed to save whiteboard state:",e)}});return()=>{e()}},[s]),(0,i.useEffect)(()=>{c.current=new l.pV,c.current.getAllObjectsFromIndexedDB("indexedDB").catch(console.error)},[]);let N=async e=>{if(!c.current||!s)return;console.log("Starting index update...");let t=await c.current.getAllObjectsFromIndexedDB("indexedDB"),r=new Map(t.map(e=>[e.shapeId,e]));for(let t of Array.from(e.entries()).map(e=>{let[t,r]=e;return{id:t,text:r.text,center:r.center}}).reduce((e,t)=>{let r=e.find(e=>200>b(t.center,e.center));return r?(r.shapes.push(t),r.center={x:r.shapes.reduce((e,t)=>e+t.center.x,0)/r.shapes.length,y:r.shapes.reduce((e,t)=>e+t.center.y,0)/r.shapes.length}):e.push({shapes:[t],center:t.center}),e},[])){let e=t.shapes.map(e=>e.text.trim()).filter(Boolean).join(" ");if(e)try{let o=t.shapes.map(e=>r.get(e.id)).filter(Boolean);if(o.length>0)for(let t of(console.log("Found existing embeddings for cluster:",{text:e,count:o.length}),o))await c.current.remove({id:t.id}),console.log("Removed old embedding:",{id:t.id,text:t.name,shapeId:t.shapeId});let n=await w(e),a={id:"cluster-".concat(Date.now(),"-").concat(Math.random()),name:e,embedding:n,shapeId:t.shapes[0].id};await c.current.add(a),console.log("Added/Updated embedding:",{text:e,shapeId:a.shapeId})}catch(e){console.error("Failed to process cluster:",e)}}await c.current.saveIndex("indexedDB"),console.log("Index update completed")},_=e=>{if(!s)return;let t=s.getShape(e.shapeId);if(t){let r=s.getShapePageBounds(t);r&&(s.centerOnPoint(r.center),s.select(t.id),console.log("Navigated to shape:",{text:e.name,shapeId:e.shapeId,currentPosition:r.center}))}else console.log("Shape not found:",e.shapeId)},G={width:2560,height:1440},W=async e=>{if(!s||0===e.length)return null;try{let t=e.map(e=>e.position),r=[...t].sort((e,t)=>e.x-t.x),o=[...t].sort((e,t)=>e.y-t.y),n=r[Math.floor(t.length/2)].x,a=o[Math.floor(t.length/2)].y,i=new x(n-G.width/2,a-G.height/2,G.width,G.height),l=s.getCurrentPageShapes().filter(e=>{let t=s.getShapeMaskedPageBounds(e);return!!t&&i.includes(t)});if(0===l.length)return null;let d=await m({editor:s,ids:l.map(e=>e.id),format:"png",opts:{bounds:i,background:s.getInstanceState().exportBackground}});return new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(d)})}catch(e){return console.error("Failed to capture area:",e),null}},F=async(e,t,r)=>{if(!L.groqApiKey)throw Error("Please set your GROQ API key in settings");try{var o,n;let a=[];a.push({role:"user",content:"You are an AI assistant helping to analyze and discuss content from a whiteboard. The user's query is related to the following content found on the whiteboard, make sense of it and assume that this part is just text extracted from the whiteboard - ignore gibberish:\n\n".concat(t)}),a.push(...e.map(e=>({role:e.role,content:e.content}))),r&&a.push({role:"user",content:[{type:"text",text:"Here is the relevant section of the whiteboard:"+t},{type:"image_url",image_url:{url:r}}]}),console.log("Sending messages to GROQ:",{messageCount:a.length,hasImage:!!r,searchContext:t.substring(0,100)+"..."});let s=await O.chat.completions.create({messages:a,model:"llama-3.2-11b-vision-preview",temperature:.7,max_tokens:2048,top_p:1,stream:!1});return(null===(n=s.choices[0])||void 0===n?void 0:null===(o=n.message)||void 0===o?void 0:o.content)||"No response generated"}catch(e){throw console.error("Error generating chat response:",e),e}},H=async()=>{if(B.trim()&&s&&c.current){if(!L.groqApiKey){z(e=>[...e,{role:"assistant",content:"Please set your GROQ API key in settings first."}]);return}M(""),z(e=>[...e,{role:"user",content:B,isLoading:!0}]),C(!0),O.apiKey=L.groqApiKey;try{let e=await w(B),t=await c.current.search(e,{topK:100,useStorage:"indexedDB"}),r=t.map(e=>{let t=s.getShape(e.object.shapeId),r=t&&"text"in t.props?t.props.text:"";return"\n".concat(r)}).join("\n\n");console.log("Search context:",r);let o=t.map(e=>{let t=s.getShape(e.object.shapeId);if(!t)return null;let r=s.getShapePageBounds(t);return r?{shape:t,position:r.center,similarity:e.similarity}:null}).filter(Boolean),n=null;if(o.length>0){n=await W(o),q(n);let e=o.sort((e,t)=>e.position.x-t.position.x)[Math.floor(o.length/2)].position.x,t=o.sort((e,t)=>e.position.y-t.position.y)[Math.floor(o.length/2)].position.y;s.centerOnPoint(new f(e,t))}else q(null);let a=await F([...P,{role:"user",content:B,isLoading:!0}],r,n);z(e=>e.map((t,r)=>r===e.length-1?{...t,isLoading:!1}:t)),z(e=>[...e,{role:"assistant",content:a}])}catch(e){console.error("Error during chat:",e),z(e=>[...e.slice(0,-1),{...e[e.length-1],isLoading:!1},{role:"assistant",content:"Sorry, there was an error processing your message."}])}finally{C(!1)}}};(0,i.useEffect)(()=>{L.groqApiKey&&(O.apiKey=L.groqApiKey,console.log("Initialized GROQ with API key from settings"))},[L.groqApiKey]);let Q=e=>{T(e),localStorage.setItem("whiteboard-settings",JSON.stringify(e)),O.apiKey=e.groqApiKey};return(0,n.jsxs)("div",{style:k.container,children:[(0,n.jsxs)("div",{style:k.mainContent,children:[(0,n.jsxs)("div",{style:k.searchContainer,children:[(0,n.jsx)("input",{type:"text",value:t,onChange:e=>r(e.target.value),placeholder:"Search within whiteboard...",style:k.input}),(0,n.jsx)("button",{type:"submit",style:k.button,children:"Search"}),(0,n.jsx)("button",{type:"button",onClick:()=>E(!K),style:k.settingsButton,children:"⚙️ Settings"})]}),K&&(0,n.jsxs)("div",{style:k.settingsPane,children:[(0,n.jsx)("h3",{style:k.settingsTitle,children:"Settings"}),(0,n.jsx)("div",{style:k.settingGroup,children:(0,n.jsxs)("label",{style:k.settingLabel,children:["GROQ API Key:",(0,n.jsx)("input",{type:"password",value:L.groqApiKey,onChange:e=>Q({...L,groqApiKey:e.target.value}),placeholder:"Enter your GROQ API key",style:k.settingInput})]})}),(0,n.jsx)("div",{style:k.settingHelp,children:"Your API key is stored locally and never sent to any server except GROQ."})]}),o.length>0&&(0,n.jsxs)("div",{style:k.resultsContainer,children:[(0,n.jsx)("h3",{style:k.resultsTitle,children:"Results:"}),(0,n.jsx)("ul",{style:k.resultsList,children:o.map(e=>(0,n.jsx)("li",{style:k.resultItem,onClick:()=>_(e),onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#f0f0f0",e.currentTarget.style.cursor="pointer"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="#ffffff"},children:e.name},e.id))})]}),(0,n.jsx)("div",{style:k.whiteboard,children:"error"===j.status?(0,n.jsxs)("div",{style:k.errorMessage,children:["Error loading whiteboard: ",j.error]}):(0,n.jsx)(i.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading whiteboard..."}),children:(0,n.jsx)(e,{store:g,onMount:d,autoFocus:!0,children:(0,n.jsx)(y,{onShapesChange:N})})})})]}),(0,n.jsxs)("div",{style:k.chatSidebar,children:[(0,n.jsx)("div",{style:k.chatHeader,children:(0,n.jsx)("h3",{style:k.chatTitle,children:"Chat"})}),(0,n.jsxs)("div",{style:k.messagesContainer,children:[P.map((e,t)=>(0,n.jsx)("div",{style:"user"===e.role?k.userMessage:k.assistantMessage,children:(0,n.jsxs)("div",{style:k.messageContent,children:[e.content,e.isLoading&&(0,n.jsx)(v,{})]})},t)),D&&(0,n.jsx)("div",{style:k.screenshotContainer,children:(0,n.jsx)("img",{src:D,alt:"Current context",style:k.screenshot,onClick:()=>{window.open(D,"_blank")}})})]}),(0,n.jsxs)("form",{style:k.chatInputContainer,onSubmit:e=>{e.preventDefault(),u||H()},children:[(0,n.jsx)("input",{type:"text",value:B,onChange:e=>M(e.target.value),placeholder:u?"Processing...":"Ask about your whiteboard...",style:k.chatInput,disabled:u}),(0,n.jsx)("button",{type:"submit",style:{...k.chatButton,opacity:u?.7:1,cursor:u?"not-allowed":"pointer"},disabled:u,children:"Send"})]})]})]})}let k={container:{height:"100vh",display:"flex",gap:"10px",padding:"10px",backgroundColor:"#ffffff"},mainContent:{flex:1,display:"flex",flexDirection:"column",gap:"10px",minWidth:0},chatSidebar:{width:"300px",display:"flex",flexDirection:"column",backgroundColor:"#f5f5f5",borderRadius:"8px",boxShadow:"-2px 0 5px rgba(0,0,0,0.1)"},chatHeader:{padding:"15px",borderBottom:"1px solid #ddd"},chatTitle:{margin:0,color:"#333",fontSize:"16px",fontWeight:"500"},messagesContainer:{flex:1,overflowY:"auto",padding:"10px",display:"flex",flexDirection:"column",gap:"10px"},userMessage:{alignSelf:"flex-end",backgroundColor:"#0066cc",color:"#ffffff",padding:"8px 12px",borderRadius:"12px 12px 0 12px",maxWidth:"85%",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},assistantMessage:{alignSelf:"flex-start",backgroundColor:"#ffffff",color:"#000000",padding:"8px 12px",borderRadius:"12px 12px 12px 0",maxWidth:"85%",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},messageContent:{marginBottom:"8px",wordBreak:"break-word",color:"inherit",fontSize:"14px",lineHeight:"1.4"},screenshotContainer:{position:"relative",width:"100%",borderRadius:"4px",overflow:"hidden",cursor:"pointer"},screenshot:{width:"100%",height:"auto",display:"block",transition:"transform 0.2s ease","&:hover":{transform:"scale(1.02)"}},chatInputContainer:{padding:"10px",borderTop:"1px solid #ddd",display:"flex",gap:"8px"},chatInput:{padding:"8px 12px",fontSize:"16px",flex:1,borderRadius:"4px",border:"1px solid #ddd",backgroundColor:"#ffffff",color:"#000000","::placeholder":{color:"#666666"}},chatButton:{padding:"8px 16px",fontSize:"14px",cursor:"pointer",backgroundColor:"#0066cc",color:"white",border:"none",borderRadius:"20px",fontWeight:"500","&:hover":{backgroundColor:"#0052a3"}},searchContainer:{display:"flex",alignItems:"center",gap:"10px",padding:"10px",backgroundColor:"#f5f5f5",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},input:{padding:"8px 12px",fontSize:"16px",flex:1,borderRadius:"4px",border:"1px solid #ddd",backgroundColor:"#ffffff",color:"#000000","::placeholder":{color:"#666666"}},button:{padding:"8px 16px",fontSize:"14px",cursor:"pointer",backgroundColor:"#0066cc",color:"white",border:"none",borderRadius:"4px",fontWeight:"500"},resultsContainer:{padding:"15px",backgroundColor:"#ffffff",borderRadius:"8px",maxHeight:"150px",overflowY:"auto",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",border:"1px solid #e0e0e0"},resultsList:{listStyle:"none",padding:0,margin:0},resultItem:{padding:"8px 12px",borderBottom:"1px solid #e0e0e0",color:"#000000",fontSize:"14px",lineHeight:"1.4",backgroundColor:"#ffffff",transition:"background-color 0.2s ease",userSelect:"none","&:last-child":{borderBottom:"none"},"&:hover":{backgroundColor:"#f8f8f8"}},resultsTitle:{margin:"0 0 10px 0",color:"#333333",fontSize:"16px",fontWeight:"500"},whiteboard:{flex:1,borderRadius:"8px",overflow:"hidden",border:"1px solid #ddd",backgroundColor:"#ffffff"},errorMessage:{padding:"20px",color:"#ff4d4d",textAlign:"center",backgroundColor:"#fff",border:"1px solid #ff4d4d",borderRadius:"8px",margin:"20px"},settingsButton:{padding:"8px 16px",fontSize:"14px",backgroundColor:"#666666",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"500",display:"flex",alignItems:"center",gap:"4px"},settingsPane:{position:"absolute",top:"60px",right:"320px",width:"300px",backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",padding:"16px",zIndex:1e3},settingsTitle:{margin:"0 0 16px 0",color:"#333333",fontSize:"16px",fontWeight:"500"},settingGroup:{marginBottom:"16px"},settingLabel:{display:"flex",flexDirection:"column",gap:"4px",color:"#333333",fontSize:"14px"},settingInput:{padding:"8px 12px",fontSize:"14px",borderRadius:"4px",border:"1px solid #ddd",backgroundColor:"#ffffff",color:"#000000",width:"100%",marginTop:"4px"},settingHelp:{fontSize:"12px",color:"#666666",marginTop:"4px"}};o()}catch(e){o(e)}},1)}},e=>{var t=t=>e(e.s=t);e.O(0,[480,130,215,744],()=>t(34143)),_N_E=e.O()}]);